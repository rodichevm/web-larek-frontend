# Проектная работа "Веб-ларек"

### Стек: HTML, SCSS, TS, Webpack

## Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

## Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура приложения

В проекте реализована структура на основе MVP-подхода.
Для связи компонентов используется **Event Emitter**, а данные получаются через **API**.
Каждый слой архитектуры (**Model**, **View**, **Presenter**) имеет чётко разграниченные обязанности.

- Слой данных(Model) отвечает за хранение и изменение данных
- Слой отображения(View) отвечает за отображение данных на странице
- Слой представления (Presenter) отвечает за связь и представление данных

### Данные, используемые в приложении

Тип с категориями товаров\
`type TCategory = 'софт-скил' | 'другое' | 'дополнительное' | 'кнопка' | 'хард-скил'`

Тип с видами оплат\
`type TOrderPayment = 'cash' | 'card';`

Тип с ошибками валидации форм\
`type FormErrors = Partial<Record<keyof IOrder, string>>;`

**IAppState** — интерфейс, описывает актуальное состояние приложения:

- `catalog: IProduct[]` - каталог товаров, массив
- `order: IOrder` - информация о заказе
- `basket: IProduct[]` - массив товаров в корзине
- `preview: string | null` - предпросмотр товара

**IProduct** — интерфейс, описывает товар

- `_id: string` - уникальный ID товара
- `description: string` - описание
- `image: string` - картинка(ссылка)
- `title: string` - название товара
- `category: TCategory` - категория товара
- `price: number` - цена

**IPage** - интерфейс описывает страницу, включая массив элементов каталога,
флаг, указывающий на отключение прокрутки страницы при открытом модальном окне, и счетчик товаров в корзине

- `catalog: HTMLElement[]`
- `locked: boolean`
- `counter: number`

**ICard** - интерфейс описывает карточку товара

- `id: string` - ID товара
- `description: string` - описание товара
- `image: string` - картинка(ссылка)
- `title: string` - название товара
- `category: TCategory`- категория товара
- `price: number` - цена
- `textButton: string` - текст кнопки
- `selected: boolean` - состояние товара (выбран или не выбран)

**IBasket** - интерфейс описывает корзину товаров

- `total: number` - суммарная стоимость товаров, добавленных в корзину
- `products: HTMLElement[]` - массив элементов товаров

**IOrderForm** — интерфейс для данных пользователя о способе оплаты и адресе доставки

- `paymentMethod: TOrderPayment` - способ оплаты
- `address: string` - адрес доставки

**IContactsForm** — интерфейс для данных пользователя телефона и электронной почты

- `phone: string` - телефон
- `email: string` - электронная почта

**IOrder** - интерфейс расширяет интерфейсы IOrderForm и IContactsForm

- `items: string[]` - массив из ID выбранных товаров
- `total: number` - суммарная стоимость товаров в заказе

**IOrderSuccess** — интерфейс для успешно оформленного заказа

- `id: string` - ID заказа
- `total: number` - суммарная стоимость товаров в заказе

### Слой данных(Model)

#### Класс Model

Абстрактный базовый класс для управления данными и взаимодействия с событиями.
Метод `emitChange` - используется для уведомления других частей приложения об изменениях в модели.

#### Класс AppState

Расширяет базовый класс Model и содержит данные о каталоге товаров, заказе,
корзине, предпросмотра товара, ошибках в формах.

Методы:

- `setCatalog(items: IProduct[]): void` - установка каталога товаров
- `setPreview(item: IProduct): void` - установка товара для предпросмотра
- `addToBasket(item: IProduct): void` - добавляет товар в корзину
- `removeFromBasket(item: IProduct): void` - удаляет товар из корзины
- `clearBasket(): void` - очищает корзину
- `validateAddress(): boolean` — валидирует адрес для заказа
- `validateContacts(): boolean` — валидирует контактные данные для заказа
- `setAddress(value: string): void` - установка адреса доставки заказа
- `setContacts(field: keyof IContactsForm, value: string): void` - установка контактных данных заказа
- `setPaymentMethod(method: TOrderPayment): void` - установка способа оплаты
- `getOrderItems(): IProduct[]` - возвращает товары в заказе
- `getTotal(): number` — возвращает суммарную стоимость товаров в заказе

#### Класс Api

Содержит в себе базовую логику отправки запросов.
В конструктор передается базовый адрес сервера и опциональный объект с заголовками
запросов.

_Методы:_

- `get`- выполняет GET запрос на переданный в параметрах эндпоинт и возвращает промис с объектом, которым ответил сервер

- `post`- принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на эндпоинт переданный как параметр при вызове метода. По умолчанию выполняется запрос, но метод запроса может быть переопределен при заданном третьем параметре при вызове.

#### Класс LarekApi

Расширяет базовый класс Api и реализует методы для работы с API веб-ларека.

`constructor(cdn: string, baseUrl: string, options?: RequestInit)`

В конструктор передается `cdn` (базовый адрес для изображений), `baseUrl` (базовый адрес API) и опциональный объект с заголовками запросов.

_Методы:_

- `getProduct(id: string): Promise<IProduct>` - получает товар по ID
- `getCatalog(): Promise<IProduct[]>` - получает каталог товаров
- `order(data: IOrder): Promise<IOrderSuccess>` - отправляет заказ на сервер

### Слой отображения(View)

#### Класс Component

Абстрактный базовый класс для отображения компонентов

_Методы:_

- `toggleClass` — переключает класс элемента
- `setText` — устанавливает текст элемента
- `setDisabled` — меняет статус блокировки элемента
- `setHidden` - скрывает элемент
- `setVisible` — показывает элемент
- `setImage` — устанавливает изображение с альтернативным текстом
- `render` - возвращает корневой DOM-элемент

#### Класс Page

Представляет компонент страницы интерфейса, расширяет базовый класс Component и включает
в себя элементы страницы (каталог товаров, корзину и
счетчик товаров в корзине)

_Поля:_

- `catalog: HTMLElement` - элемент каталога
- `basket: HTMLElement` - элемент корзины
- `counter: HTMLElement` — счетчик товаров в корзине

_Методы:_

- `set counter(value:number): void` — метод для установки значение счетчика товаров в корзине
- `set catalog(items: HTMLElement[]): void` - метод для установки списка товаров в каталог
- `set locked(value: boolean): void` - блокировка или разблокировка скролла страницы

#### Класс Card

Расширяет базовый класс Component, представляет компонент карточки товара (отображает информацию о товаре и
дополнительно содержит кнопку для взаимодействия с товаром в каталоге и кнопку для модального окна)

`constructor(protected blockName: string, container: HTMLElement, actions?: ICardActions)`

В конструктор передается `blockName` (имя блока для элементов),
`HTMLElement` (элемент, в который встраивается компонент карточки) и `action` (`ICardActions`- объект, содержащий действие для кнопки)

_Поля:_

- `title: HTMLElement` - элемент отображает название
- `description: HTMLElement` - элемент отображает описание
- `image: HTMLElement` - элемент отображает изображение
- `category: HTMLElement` - элемент отображает категорию
- `price: HTMLElement` - элемент отображает цену
- `button: HTMLButtonElement` - кнопка карточки товара
- `buttonModal: HTMLButtonElement` - кнопка в модальном окне

_Методы:_

- `set title(value: string): void` - установка названия
- `set description(value: string): void` - установка описания
- `set image(value: string): void` - установка изображения
- `set category(value: string): void` - установка категории
- `set price(value: number): void` - установка цены
- `set id(value: string): void` - установка ID товара
- `set textButton(value: string): void` - установка текста кнопки

#### Класс Modal

Расширяет базовый класс Component, представляет модальное окно, которое может быть использовано для отображения контента внутри, управления открытием и закрытием окна, а также для управления событиями внутри окна.

_Поля:_

- `content: HTMLElement` — элемент, содержащий контент модального окна
- `closeButton: HTMLButtonElement` - кнопка закрытия модального окна

_Методы:_

- `set content(value: HTMLElement): void` - установка контента модального окна
- `render(data: IModalData): HTMLElement` - рендеринг модального окна с открытием
- `open(): void` - открытие модального окна
- `close(): void` - закрытие модального окна

#### Класс Basket

Расширяет базовый класс Component, представляет корзину товаров, отображает список выбранных товаров в корзине, общую стоимость и кнопку для оформления заказа.

`constructor(container: HTMLElement, events: EventEmitter)`

В конструктор передается `HTMLElement` (элемент, в который встраивается компонент корзины) и events (экземпляр, реализующий интерфейс IEvents, например, `EventEmitter`)

_Поля:_

- `total: HTMLElement` — элемент, отображающий общую стоимость товаров в корзине
- `products: HTMLElement[]` — массив элементов товаров в корзине
- `button: HTMLButtonElement` — кнопка для оформления заказа

_Методы:_

- `set total(value: number): void` — установка общей стоимости товаров в корзине
- `set products(items: HTMLElement[]): void` - установка списка товаров в корзине
- `disableButton(): void` - блокировка кнопки оформления заказа
- `enableButton(): void` - разблокировка кнопки оформления заказа

#### Класс BasketProduct

Расширяет базовый класс Component, представляет отдельный товар в корзине, отображает информацию о товаре (номер, название, цена) и кнопку для удаления товара из корзины.

`constructor(container: HTMLElement, index: number, action?: ICardActions)`
В конструктор передается `HTMLElement` (элемент, в который встраивается компонент товара в корзине), `index` (индекс товара в корзине) и `action` (`ICardActions`-объект с действиями для кнопки удаления товара)

_Поля:_

- `index: number` - индекс товара в корзине
- `title: HTMLElement` — элемент, отображающий название товара
- `price: HTMLElement` — элемент, отображающий цену товара
- `button: HTMLButtonElement` — кнопка для удаления товара из корзины

_Методы:_

- `set title(value: string): void` - установка названия товара
- `set price(value: number): void` - установка цены товара
- `set index(value: number): void` - установка индекса товара в корзине

#### Класс Form

Расширяет базовый класс Component, представляет базовый компонент формы, с валидатором и обработкой событий.

`constructor(container: HTMLFormElement, events: IEvents)`

В конструктор передается `HTMLFormElement` (элемент формы) и `events` (экземпляр, реализующий интерфейс IEvents, например, `EventEmitter`)

_Поля:_

- `submitButton: HTMLButtonElement` - кнопка отправки формы
- `errorElement: HTMLElement` — элемент для отображения ошибок валидации формы

_Методы:_

- `onInputChange(field: keyof T, value: string): void` - обработка изменения значения в поле формы
- `set valid(value: boolean): void` - установка валидности формы и состояния кнопки
- `set error(value: string): void` - установка текста ошибки валидации формы
- `render(state: Partial<T> & IFormState<T>): HTMLElement` - рендеринг формы с передачей состояния

#### Класс OrderForm

Расширяет базовый класс Form, представляет форму для оформления заказа, включает поля для способа оплаты и адреса доставки и методы для управления этими полями.

`constructor(container: HTMLFormElement, events: IEvents)`

В конструктор передается `HTMLFormElement` (элемент формы заказа) и `events` (экземпляр, реализующий интерфейс IEvents, например, `EventEmitter`)

_Поля:_

- `paymentMethod: HTMLElement` — контейнер, внутри которого находятся кнопки выбора способа оплаты
- `paymentButtons: HTMLButtonElement[]` — массив кнопок для выбора способа оплаты
- `addressInput: HTMLInputElement` — поле для ввода адреса доставки

_Методы:_

- `set paymentMethod(value: string): void` - установка способа оплаты
- `set address(value: string): void` - установка адреса доставки

#### Класс ContactsForm

Расширяет базовый класс Form, представляет форму для контактных данных пользователя, включает поля для телефона и электронной почты и методы для управления этими полями.

`constructor(container: HTMLFormElement, events: IEvents)`

В конструктор передается `HTMLFormElement` (элемент формы контактов) и `events` (экземпляр, реализующий интерфейс IEvents, например, `EventEmitter`)

_Поля:_

- `phoneInput: HTMLInputElement` — поле для ввода телефона
- `emailInput: HTMLInputElement` — поле для ввода электронной почты

_Методы:_

- `set phone(value: string): void` - установка телефона
- `set email(value: string): void` - установка электронной почты

#### Класс OrderSuccess

Расширяет базовый класс Component, представляет компонент успешного оформления заказа, отображает информацию о заказе и кнопку для закрытия сообщения.

`constructor(container: HTMLElement, data: IOrderSuccess)`

В конструктор передается `HTMLElement` (элемент, в который встраивается компонент успешного оформления заказа)
и `data` (`IOrderSuccess`-данные успешно оформленного заказа)

_Поля:_

- `total: HTMLElement` — элемент, отображающий общую стоимость заказа
- `closeButton: HTMLButtonElement` — кнопка для закрытия сообщения об успешном заказе

_Методы:_

- `setText(text: string, element: HTMLElement): void` - установка текста элемента
  в модальном окне об успешном заказе

### Слой Presenter

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом, описаны интерфейсом IEvents:

- `on`- подписка на событие
- `off`- отписка от события
- `emit`- генерация события
- `trigger` — возвращает функцию, которая при вызове с аргументами вызывает событие с этими аргументами

Презентер не выделен в отдельный класс. Его роль выполняет основной скрипт проекта — файл `src/index.ts`, где происходит связывание модели и компонентов отображения (View), а также обработка событий. Этот слой управляет логикой приложения, реагирует на пользовательские действия и обновляет представление в соответствии с изменениями данных.
