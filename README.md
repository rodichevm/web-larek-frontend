# Проектная работа "Веб-ларек"

### Стек: HTML, SCSS, TS, Webpack

## Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

## Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура приложения

В проекте реализована структура на основе MVP-подхода.
Каждый слой архитектуры (**Model**, **View**, **Presenter**) имеет чётко разграниченные обязанности.

- **Model** хранит только данные (простые типы, объекты, массивы)
- **View** отвечает только за отображение. Классы получают шаблон и экземпляр EventEmitter. Генерирует события пользовательских действий и реагирует на команды от Presenter. Никогда не хранит бизнес-логику или состояние.
- **Presenter** связывает Model и View через события в брокере EventEmitter

### Базовый код

#### Класс Model

Абстрактный базовый класс для создания данных модели.

`constructor(data: Partial<T>, events: IEvents)` - конструктор передается объект с данными и экземпляр `EventEmitter`

Методы:

- `emitChanges` - используется для уведомления других частей приложения об изменениях в модели

#### Класс Component

Абстрактный базовый класс для создания компонентов интерфейса. От него наследуются все классы View.

`constructor(container: HTMLElement)` - в конструктор передается контейнер, в который будет встроен компонент

Методы:

- `toggleClass(element: HTMLElement, className: string, force?: boolean):void` — переключает класс элемента
- `setText(element: HTMLElement, value: unknown):void` — устанавливает текст элемента
- `setDisabled(element: HTMLElement, state: boolean):void` — меняет статус блокировки элемента
- `setHidden(element: HTMLElement):void` - скрывает элемент
- `setVisible(element: HTMLElement):void` — показывает элемент
- `setImage(element: HTMLImageElement, src: string, alt?: string):void` — устанавливает изображение с альтернативным текстом
- `render(data?: Partial<T>): HTMLElement` - рендерит компонент с учетом переданных данных, может быть переопределён в дочерних классах

#### Класс Api

Содержит в себе базовую логику для работы с API

`constructor(baseUrl: string, options?: RequestInit)` -
в конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов

Методы:

- `get`- выполняет GET запрос на переданный в параметрах эндпоинт и возвращает промис с объектом, которым ответил сервер
- `post`- принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на эндпоинт, переданный как параметр при вызове метода. По умолчанию выполняется запрос `post`, но метод запроса может быть переопределен при заданном третьем параметре при вызове.
- `handleResponse` - обрабатывает ответ сервера, проверяет статус ответа и возвращает JSON-данные или выбрасывает ошибку

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом, описаны интерфейсом IEvents:

- `on`- подписка на событие
- `emit`- генерация события
- `trigger` — возвращает функцию, которая при вызове с аргументами вызывает событие с этими аргументами

### Интерфейсы и типы, используемые в приложении

Тип с категориями товаров\
`type TCategory = 'софт-скил' | 'другое' | 'дополнительное' | 'кнопка' | 'хард-скил'`

Тип с видами оплат\
`type TOrderPayment = 'cash' | 'card';`

Тип с ошибками валидации форм\
`type FormErrors = Partial<Record<keyof IOrder, string>>;`

**IProduct** — интерфейс, описывает товар

- `id: string` - уникальный ID товара
- `description: string` - описание
- `image: string` - картинка(ссылка)
- `title: string` - название товара
- `category: TCategory` - категория товара
- `price: number` - цена

**IAppState** — описывает состояние приложения

- `catalog: IProduct[]` - каталог товаров, массив
- `order: IOrder` - информация о заказе
- `basket: IProduct[]` - массив товаров в корзине
- `preview: IProduct | null` - предпросмотр товара

**IModalData** — интерфейс для модального окна

- `content: HTMLElement` - контент модального окна

**IFormState** — интерфейс для состояния формы

- `valid: boolean` - валидность формы
- `errors: string[]` - массив ошибок валидации формы

**ICard** — расширяет интерфейс **IProduct** и описывает карточку товара

- `index?: string` - индекс карточки товара в корзине
- `textButton?: string`

**IBasketView** - интерфейс описывает корзину товаров

- `total: number` - суммарная стоимость товаров, добавленных в корзину
- `items: HTMLElement[]` - массив товаров в корзине

**IOrderForm** — интерфейс для данных пользователя о способе оплаты и адресе доставки

- `paymentMethod: TOrderPayment` - способ оплаты
- `address: string` - адрес доставки

**IContactsForm** — интерфейс для данных пользователя телефона и электронной почты

- `phone: string` - телефон
- `email: string` - электронная почта

**IOrder** - интерфейс расширяет интерфейсы IOrderForm и IContactsForm

- `items: string[]` - массив из ID выбранных товаров
- `total: number` - суммарная стоимость товаров в заказе

**ISuccess** — интерфейс успешного оформленного заказа

- `id: string` - ID заказа
- `total: number` - суммарная стоимость товаров в заказе

**IPage** — это интерфейс для компонента View (Page),
и его поля используются только для отображения, включая массив элементов каталога

- `catalog: HTMLElement[]` — массив DOM-элементов каталога для отображения
- `locked: boolean` — флаг блокировки прокрутки (например, при открытом модальном окне)
- `counter: number` количество товаров в корзине (для отображения)

### Слой данных(Model)

#### Класс AppState

Используется для хранения состояния приложения и управления данными. Наследует базовый класс Model<IAppState> и реализует интерфейс IAppState

Методы:

- `setCatalog(items: IProduct[]): void` - установка каталога товаров
- `setPreview(item: IProduct): void` - установка товара для предпросмотра
- `addToBasket(item: IProduct): void` - добавляет товар в корзину
- `removeFromBasket(item: IProduct): void` - удаляет товар из корзины
- `clearBasket(): void` - очищает корзину
- `validateAddress(): boolean` — валидирует адрес для заказа
- `validateContacts(): boolean` — валидирует контактные данные для заказа
- `setAddress(value: string): void` - установка адреса доставки заказа
- `setContacts(field: keyof IContactsForm, value: string): void` - установка контактных данных заказа
- `getTotal(): number` — возвращает суммарную стоимость товаров в заказе

#### Класс Product

Наследуется от базового класса Model<IProduct>, предоставляет информацию о товаре, с возможностью ее дальнейшего использования в отображении в слое View и обработке в бизнес-логике, реализует интерфейс IProduct

#### Класс LarekApi

Расширяет базовый класс Api и реализует методы для работы с API веб-ларека.

`constructor(cdn: string, baseUrl: string, options?: RequestInit)`

В конструктор передается `cdn` (базовый адрес для изображений), `baseUrl` (базовый адрес API) и опциональный объект с заголовками запросов.

Методы:

- `getProduct(id: string): Promise<IProduct>` - получает товар по ID
- `getCatalog(): Promise<IProduct[]>` - получает каталог товаров
- `order(data: IOrder): Promise<IOrderSuccess>` - отправляет заказ на сервер

---

### Слой отображения(View)

#### Общие компоненты

#### Класс Modal

Наследует базовый класс Component<IModalData>, представляет универсальное модальное окно, которое может быть использовано для отображения контента и управления его открытием и закрытием

_Поля:_

- `content: HTMLElement` — элемент, содержащий контент модального окна
- `closeButton: HTMLButtonElement` - кнопка закрытия модального окна

Методы:

- `set content(value: HTMLElement): void` - установка контента модального окна
- `open(): void` - открытие модального окна
- `close(): void` - закрытие модального окна
- `render(data: IModalData): HTMLElement` - рендеринг модального окна с учетом контента и открывает его

#### Класс Form

Наследует базовый класс Component<IFormState>, представляет базовый компонент формы.

`constructor(protected container: HTMLFormElement, protected events: IEvents)`

Поля:

- `submit: HTMLButtonElement` - кнопка отправки формы
- `errors: HTMLElement` — элемент для отображения ошибок валидации формы

Методы:

- `onInputChange(field: keyof T, value: string): void` - обработка изменения значения в поле формы
- `set valid(value: boolean): void` - установка валидности формы и состояния кнопки
- `set errors(value: string[]): void` - установка текста ошибки валидации формы
- `render(state: Partial<T> & IFormState<T>): HTMLElement` - рендеринг формы с передачей состояния

---

#### Класс Page

Представляет компонент страницы интерфейса IPage, наследует базовый класс Component<IPage> и включает
в себя элементы страницы (каталог товаров, корзину и
счетчик товаров в корзине)

Поля:

- `catalog: HTMLElement` - элемент каталога
- `basket: HTMLElement` - элемент корзины
- `counter: HTMLElement` — счетчик товаров в корзине

Методы:

- `set counter(value:number): void` — метод для установки значение счетчика товаров в корзине
- `set catalog(items: HTMLElement[]): void` - метод для установки списка товаров в каталог
- `set locked(value: boolean): void` - блокировка или разблокировка интерфейса страницы

#### Класс Card

Наследует базовый класс Component<ICard>, отображает компонент карточки товара(в каталоге, предпросмотре и корзине). Отображает данные по интерфейсу IProduct.

`constructor(container: HTMLElement, actions?: ICardActions)`

В конструктор передается `HTMLElement` (элемент, в который встраивается компонент карточки) и опционально `actions` (`ICardActions`- объект, содержащий действие для кнопки)

Методы:

- `set id(value: string): void` - установка ID товара
- `get id(): string` - получение ID товара
- `set title(value: string): void` - установка названия
- `get title(): string` - получение названия
- `set description(value: string): void` - установка описания
- `set image(value: string): void` - установка изображения
- `set category(value: string): void` - установка категории
- `get category(): string` - получение категории
- `set price(value: number): void` - установка цены
- `get price(): number` - получение цены
- `set textButton(value: string): void` - установка текста кнопки

#### Класс Basket

Наследует базовый класс Component<IBasketView>, представляет корзину товаров, отображает список выбранных товаров в корзине, общую стоимость и кнопку для оформления заказа

Поля:

- `items: HTMLElement[]` — массив элементов товаров в корзине
- `total: HTMLElement` — элемент, отображающий сумму товаров в корзине
- `button: HTMLButtonElement` — кнопка для оформления заказа

Методы:

- `set total(value: number): void` — установка общей стоимости товаров в корзине
- `set items(items: HTMLElement[]): void` - установка списка элементов товаров в корзине
- `toggleButton(items: string[]): void` - проверка наличия выбранных товаров в корзине, в котором реализовано включение/отключение кнопки оформления заказа

#### Класс OrderForm

Наследуется от класса Form<IOrderForm>, отображает форму для оформления заказа, включает поля для способа оплаты и адреса доставки и методы для управления этими полями

Поля:

- `paymentMethods: HTMLElement` — контейнер, внутри которого находятся кнопки выбора способа оплаты
- `paymentButtons: HTMLButtonElement[]` — массив кнопок для выбора способа оплаты
- `addressInput: HTMLInputElement` — поле для ввода адреса доставки

Методы:

- `set toggleButtons(value: string): void` - переключение кнопок способа оплаты
- `set address(value: string): void` - установка адреса доставки

#### Класс ContactsForm

Наследуется от класса Form<IContactsForm>, представляет форму для контактных данных пользователя, включает поля для телефона и электронной почты и методы для управления этими полями.

Поля:

- `phoneInput: HTMLInputElement` — поле для ввода телефона
- `emailInput: HTMLInputElement` — поле для ввода электронной почты

Методы:

- `set phone(value: string): void` - установка телефона
- `set email(value: string): void` - установка электронной почты

#### Класс Success

Наследует базовый класс Component<ISuccess>, отображает компонент успешного оформления заказа и кнопку для закрытия сообщения

Поля:

- `total: HTMLElement` — элемент, отображающий общую стоимость заказа
- `closeButton: HTMLButtonElement` — кнопка для закрытия сообщения об успешном заказе

Методы:

- `set total(total: number): void` - устанавливает сумму заказа

---

### Слой Presenter

Презентер не выделен в отдельный класс. Его роль выполняет основной скрипт проекта — файл `src/index.ts`,
где происходит подписка на события от View, вызовы методов модели, обновление View на основе данных модели

**Пример цепочки событий:**

1. Пользователь кликает по кнопке в карточке товара (View)
2. View генерирует событие через EventEmitter
3. Presenter (index.ts) ловит событие, вызывает метод Model.
4. Model обновляет данные и эмитит событие об изменении
5. Presenter ловит это событие и обновляет View

**Список событий, которые обрабатываются в Presenter:**

- `items:changed`-обновление каталога товаров
- `card:select` - выбор карточки товара в каталоге
- `preview:changed` - изменение окна предпросмотра товара
- `order:open`- открытие формы заказа
- `order:submit` - отправлена форма заказа
- `order\название_поля:change` - изменилось одно из полей
- `formErrors:change` - изменилось состояние валидации формы
- `modal:open` - открытие модального окна и блокировка прокрутки
- `modal:close` - закрытие модального окна и разблокировка прокрутки
- `basket:changed` - обновление корзины товаров
- `item:added` - добавление товара в корзину
- `item:removed` - удаление товара из корзины

